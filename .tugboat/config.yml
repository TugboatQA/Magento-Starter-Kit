services:
  php:
    image: tugboatqa/php:7.1-apache
    default: true
    depends: mysql
    
    commands:
      init:
        - docker-php-ext-install opcache
        - docker-php-ext-install bcmath
        - apt-get update && apt-get install -y zlib1g-dev libicu-dev g++
        - docker-php-ext-configure intl
        - docker-php-ext-install intl
        - apt-get install -y libxslt-dev
        - docker-php-ext-install xsl
        - apt-get install -y libzip-dev
        - pecl install zip
        - docker-php-ext-enable zip
        - apt-get install -y libxml2-dev
        - docker-php-ext-install soap
        - a2enmod headers rewrite
        
      build:
        # sed -i makes a backup file. I don't like that
        - sed -in "s/MAGENTO_USER/${MAGENTO_USER}/" ${TUGBOAT_ROOT}/auth.json
        - sed -in "s/MAGENTO_PASS/${MAGENTO_PASS}/" ${TUGBOAT_ROOT}/auth.json
        - mv ${TUGBOAT_ROOT}/auth.json /root/.composer/
        
        - composer create-project --repository=https://repo.magento.com/ magento/project-community-edition magento
    
  mysql:
    image: tugboatqa/mysql:5
